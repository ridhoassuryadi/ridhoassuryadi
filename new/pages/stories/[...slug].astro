---
import { getCollection } from 'astro:content';
import ProjectsLayout from '@/shared/ui/layouts/ProjectsLayout.astro';

export async function getStaticPaths() {
  const projects = await getCollection('stories');
  return projects.map(page => ({
    params: { slug: page.slug },
    props: { page },
    trailingSlash: false,
  }));
}

const { page } = Astro.props;

// Fetch and filter valid project entries
const allProjects = await getCollection('stories');
const validProjects = allProjects.filter(item => item.data?.title);

// Keep original order or optionally sort
const sorted = validProjects; // or sorted by title if needed

// Find current index and surrounding items
const index = sorted.findIndex(item => item.slug === page.slug);
const previous = sorted[index - 1] || null;
const next = sorted[index + 1] || null;

const { Content } = await page.render();
---

<ProjectsLayout frontmatter={page.data} previous={previous} next={next}>
  <Content />
</ProjectsLayout>
