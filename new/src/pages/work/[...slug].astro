---
import { getCollection } from 'astro:content';
import WorkLayout from '@/shared/ui/layouts/WorkLayout.astro';

export async function getStaticPaths() {
  const work = await getCollection('work');
  return work.map(page => ({
    params: { slug: page.slug },
    props: { page },
    trailingSlash: false,
  }));
}

const { page } = Astro.props;

// Fetch all valid work entries
const allWork = await getCollection('work');
const validWork = allWork.filter(item => item.data?.title);

// Use collection order (or optionally sort by title)
const sorted = validWork; // or validWork.sort((a, b) => a.data.title.localeCompare(b.data.title))

// Determine current, previous, and next entries
const index = sorted.findIndex(item => item.slug === page.slug);
const previous = sorted[index - 1] || null;
const next = sorted[index + 1] || null;

const { Content } = await page.render();
---

<WorkLayout frontmatter={page.data} previous={previous} next={next}>
  <Content />
</WorkLayout>
